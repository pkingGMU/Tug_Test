% Function that will calculate mean, std deviation of angular velocity during a turn

function calculation_data = calculations(fileData)

    % Data extraction
    num_trials = size(fileData, 1);
    % Preallocate empty cell
    angular_velocity_trunk_single_task = zeros(num_trials, 1);
    angular_velocity_lumbar_single_task = zeros(num_trials, 1);
    angular_velocity_trunk_dual_task = zeros(num_trials, 1);
    angular_velocity_lumbar_dual_task = zeros(num_trials, 1);

    % Loop through each trial
    for trial = 1:num_trials
        % Get data from fileData
        trial_name = fileData{trial, 1};
        trial_data = fileData{trial, 2};
        task_type = fileData{trial, 3};

        % Get angular velocities
        if contains(task_type, 'ST')
            angular_velocity_trunk_single_task(trial) = trial_data.Pk_TurnV_Trunk;
            angular_velocity_lumbar_single_task(trial) = trial_data.Pk_TurnV_Lumbar;
        elseif contains(task_type, 'DT')
            angular_velocity_trunk_dual_task(trial) = trial_data.Pk_TurnV_Trunk;
            angular_velocity_lumbar_dual_task(trial) = trial_data.Pk_TurnV_Lumbar;
        end
    end

    % Remove empty cells and add our new max 
    calc.raw.angular_velocity_trunk_single_task = nonzeros(angular_velocity_trunk_single_task);
    calc.raw.angular_velocity_lumbar_single_task = nonzeros(angular_velocity_lumbar_single_task);
    calc.raw.angular_velocity_trunk_dual_task = nonzeros(angular_velocity_trunk_dual_task);
    calc.raw.angular_velocity_lumbar_dual_task = nonzeros(angular_velocity_lumbar_dual_task);
    
    % Troubleshooting
    calculation_data = angular_velocity_trunk_single_task;
    
    % Plotting
    subplot(2, 2, 1);
    plot_data(angular_velocity_trunk_single_task, 'p', 'Trunk Single Task')
    subplot(2, 2, 2);
    plot_data(angular_velocity_lumbar_single_task, 'g', 'Lumbar Single Task');
    subplot(2, 2, 3);
    plot_data(angular_velocity_trunk_dual_task, 'r', 'Trunk Dual Task');
    subplot(2, 2, 4)
    plot_data(angular_velocity_lumbar_dual_task, 'm', 'Lumbar Dual Task');
    
end





